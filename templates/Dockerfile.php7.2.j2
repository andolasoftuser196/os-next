# PHP 7.2 Environment for OrangeScrum V2 (Legacy)
# Based on common Ubuntu base
# Generated: {{ generation_date }}

ARG BASE_IMAGE=orangescrum-base:{{ domain | replace('.', '-') }}
FROM ${BASE_IMAGE}

# Install PHP 7.2 and required extensions
RUN apt update && \
    apt install -y --no-install-recommends \
        libapache2-mod-php7.2 \
        php7.2 \
        php7.2-cli \
        php7.2-common \
        php7.2-mbstring \
        php7.2-xml \
        php7.2-mysql \
        php7.2-intl \
        php7.2-zip \
        php7.2-curl \
        php7.2-gd \
        php7.2-memcached \
        php7.2-soap \
        php7.2-bcmath \
        php7.2-json && \
    apt clean && rm -rf /var/lib/apt/lists/*

# Install Composer (pinned to version 2.2 for PHP 7.2 compatibility)
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer --2.2

# Copy certificate trust script
COPY php-trust-certs.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/php-trust-certs.sh

# Set PHP version for CLI
RUN update-alternatives --set php /usr/bin/php7.2

WORKDIR /var/www/html

CMD ["sh", "-c", "/usr/local/bin/php-trust-certs.sh && apache2ctl -D FOREGROUND"]
