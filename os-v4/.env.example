# OrangeScrum Full Stack Environment Configuration
# Copy this file to .env and customize for your environment

# ============================================
# Project Configuration
# ============================================
COMPOSE_PROJECT_NAME=orangescrum-cloud

# ============================================
# Port Configuration (Host Bindings)
# ============================================
# PRODUCTION: Set APP_BIND_IP=127.0.0.1 when behind reverse proxy (nginx/Apache)
# DEVELOPMENT/DIRECT ACCESS: Set APP_BIND_IP=0.0.0.0 (ensure firewall rules are in place)

# OrangeScrum Application
APP_BIND_IP=127.0.0.1
APP_PORT=8080

# ============================================
# Database Configuration (External / Managed)
# ============================================
# These are used by the application to connect to your external database.
# For local dev, you can point this at the host machine.
DB_HOST=host.docker.internal
DB_PORT=5432
DB_USERNAME=orangescrum
DB_PASSWORD=
DB_NAME=orangescrum

# CRITICAL: Set a strong password before deployment!
# Generate a strong password with: openssl rand -base64 24
# Example: DB_PASSWORD=$(openssl rand -base64 24)

# ============================================
# Application Configuration
# ============================================
# Set to 'true' only for development/debugging
# CRITICAL: Must be 'false' in production for security
DEBUG=false

# Security salt for encryption and hashing (REQUIRED)
# CRITICAL: Generate a unique value before deployment!
# Generate with: openssl rand -base64 32
# Example: SECURITY_SALT=$(openssl rand -base64 32)
SECURITY_SALT=

# Cache engine: 'file', 'redis', or 'memcached'
# Use 'file' for simple deployments without external cache services
# Use 'redis' for production (better performance, supports distributed cache)
CACHE_ENGINE=redis

# Queue engine: 'redis' or 'database'
# Use 'redis' for better performance in production
QUEUE_ENGINE=redis

# Queue URL (Redis format with TLS for AWS ElastiCache)
# Format: rediss://:password@host:port/database
# Example: rediss://:your-auth-token@master.xxxxx.use1.cache.amazonaws.com:6379/1
QUEUE_URL=rediss://:your-password@localhost:6379/0

# Skip database migrations on startup (useful for production)
# SKIP_MIGRATIONS=1

# ============================================
# Redis Configuration (External)
# ============================================
# Point to your external Redis server or AWS ElastiCache
# Examples:
#   - External Redis: redis.example.com
#   - AWS ElastiCache: my-cluster.abc123.cache.amazonaws.com
#   - Local Redis: localhost (if running on host)
REDIS_HOST=localhost
REDIS_PORT=6379
# Set password if your Redis requires authentication
REDIS_PASSWORD=
REDIS_DATABASE=0
# Cache key prefix to avoid collisions with other apps
REDIS_PREFIX=cake_
# Connection timeout in seconds
REDIS_TIMEOUT=1

# AWS ElastiCache TLS Configuration (for encrypted Redis)
# Enable TLS/SSL for Redis connections (required for AWS ElastiCache with encryption)
REDIS_TLS_ENABLED=false
# Verify SSL peer certificate (set to false for self-signed certificates)
REDIS_TLS_VERIFY_PEER=false

# ============================================
# PHP Configuration
# ============================================
# PHP memory limit for script execution
PHP_MEMORY_LIMIT=512M
# Maximum POST data size (file uploads)
PHP_POST_MAX_SIZE=200M
# Maximum file upload size
PHP_UPLOAD_MAX_FILESIZE=200M
# Maximum script execution time (seconds)
PHP_MAX_EXECUTION_TIME=300

# ============================================
# Email Configuration
# ============================================
# Email transport: 'smtp' or 'sendgrid'
EMAIL_TRANSPORT=sendgrid

# SMTP Configuration (if EMAIL_TRANSPORT=smtp)
# Common SMTP ports: 25 (plain), 587 (TLS), 465 (SSL)
SMTP_HOST=
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_TLS=true

# SendGrid Configuration (if EMAIL_TRANSPORT=sendgrid)
# Get your API key from: https://app.sendgrid.com/settings/api_keys
EMAIL_API_KEY=

# Email addresses
FROM_EMAIL=noreply@orangescrum.local
NOTIFY_EMAIL=admin@orangescrum.local

# ============================================
# S3-Compatible Storage (REQUIRED)
# ============================================
# All file uploads are stored in S3-compatible storage (AWS S3, MinIO, DigitalOcean Spaces, etc.)
# This is required for production deployments

# Storage endpoint (required)
# Examples:
#   - AWS S3: https://s3.amazonaws.com
#   - DigitalOcean Spaces: https://nyc3.digitaloceanspaces.com
#   - MinIO: http://minio.example.com:9000
STORAGE_ENDPOINT=https://s3.amazonaws.com
# Get from your cloud provider's IAM/API keys section
STORAGE_ACCESS_KEY=
STORAGE_SECRET_KEY=
STORAGE_ACCESS_KEY=your-access-key
STORAGE_SECRET_KEY=your-secret-key

# Bucket name (required)
STORAGE_BUCKET=orangescrum-files

# AWS region (required for AWS S3, optional for others)
STORAGE_REGION=us-east-1

# Path-style endpoint (true for MinIO, false for AWS S3)
STORAGE_PATH_STYLE=false

# ============================================
# Session Configuration
# ============================================
# Session handler: 'cache' (Redis), 'database', or 'php'
# Use 'cache' for Redis-backed sessions (recommended for production)
SESSION_HANDLER=cache

# Session cookie domain (optional)
# Set to .yourdomain.com for cross-subdomain sessions
SESSION_COOKIE_DOMAIN=

# ============================================
# Google reCAPTCHA (Optional)
# ============================================
# Enable reCAPTCHA for login/signup forms
# Get keys from: https://www.google.com/recaptcha/admin

# Enable reCAPTCHA
RECAPTCHA_ENABLED=false

# reCAPTCHA Site Key (public key for frontend)
RECAPTCHA_SITE_KEY=

# reCAPTCHA Secret Key (private key for backend)
RECAPTCHA_SECRET_KEY=

# reCAPTCHA Version: 'v2' (checkbox) or 'v3' (invisible)
RECAPTCHA_VERSION=v3

# Minimum score for v3 (0.0 to 1.0, lower = more likely bot)
RECAPTCHA_MIN_SCORE=0.5

# ============================================
# Google OAuth (Optional)
# ============================================
# Enable Google Sign-In for users
# Setup: https://console.cloud.google.com

# Enable Google OAuth
GOOGLE_OAUTH_ENABLED=false

# Google OAuth Client ID
GOOGLE_OAUTH_CLIENT_ID=

# Google OAuth Client Secret
GOOGLE_OAUTH_CLIENT_SECRET=

# OAuth Redirect URI (must match Google Cloud Console)
# Example: https://app.yourdomain.com/oauth/google/callback
GOOGLE_OAUTH_REDIRECT_URI=

# ============================================
# Cloud Storage Integrations (Optional)
# ============================================
# Enable Google Drive, Dropbox, OneDrive integrations
# See config/cloudstorage.example.php for detailed setup instructions

# Domain for OAuth callbacks
# CLOUD_STORAGE_AUTH_DOMAIN=app.orangescrum.com

# Google Drive OAuth (optional)
# GOOGLE_DRIVE_CLIENT_ID=
# GOOGLE_DRIVE_CLIENT_SECRET=
# GOOGLE_DRIVE_API_KEY=

# ============================================
# Queue Worker Configuration
# ============================================
# Maximum runtime for a single worker process (seconds)
WORKER_MAX_RUNTIME=1800
# Sleep time between queue checks (seconds)
WORKER_SLEEP=5

# ============================================
# V2/V4 Routing Configuration
# ============================================
# CRITICAL: Generate a unique value if V4_ROUTING_ENABLED=true
# Generate with: openssl rand -base64 32
# This must match the V4_API_KEY in the v2 application
# Example: V2_ROUTING_API_KEY=$(openssl rand -base64 32)
V2_ROUTING_API_KEY=
# Generate with: openssl rand -base64 32
# This must match the V4_API_KEY in the v2 application
V2_ROUTING_API_KEY=your-secure-api-key-here-change-this

# Base URL for the V2 application (common login page)
# Should NOT include trailing slash
# Examples:
#   - Production: https://app.ossiba.com
#   - Development: http://localhost:8000
V2_BASE_URL=https://app.ossiba.com

# Base URL for the V4 application
# Should NOT include trailing slash
# Examples:
#   - Production: https://v4.ossiba.com
#   - Development: http://localhost:8080
V4_BASE_URL=https://v4.ossiba.com

# Auto-login token expiration time (in minutes)
V2_ROUTING_TOKEN_EXPIRATION=15

# API request timeout (in seconds)
V2_ROUTING_TIMEOUT=10

# SSL verification for API requests (set to false only in development)
V2_ROUTING_SSL_VERIFY=true

# Enable V4 routing (routing users from v4 to v2 common login page)
# Set to false when v4 is deployed as a standalone application
V4_ROUTING_ENABLED=false

# ============================================
# GitHub Integration (Optional)
# ============================================
# Setup: https://github.com/settings/developers
# Create OAuth App for GitHub integration
GITHUB_CLIENT_NAME=
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
GITHUB_REDIRECT_URI=
GITHUB_HOOK_URI=

# ============================================
# GitSync Plugin Configuration (Optional)
# ============================================
# GitHub GitSync (if using GitSync plugin)
GITHUB_WEBHOOK_SECRET=

# GitLab GitSync
GITLAB_CLIENT_NAME=
GITLAB_CLIENT_ID=
GITLAB_CLIENT_SECRET=
GITLAB_REDIRECT_URI=
GITLAB_INSTANCE_URL=https://gitlab.com
GITLAB_WEBHOOK_SECRET=

# Bitbucket GitSync
BITBUCKET_CLIENT_NAME=
BITBUCKET_CLIENT_ID=
BITBUCKET_CLIENT_SECRET=
BITBUCKET_REDIRECT_URI=
BITBUCKET_WEBHOOK_SECRET=

# ============================================
# Stripe Payment Integration (Optional)
# ============================================
# Setup: https://dashboard.stripe.com/apikeys
STRIPE_PUBLISHABLE_KEY=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_CURRENCY=usd

# ============================================
# Cloud Storage Integrations (Optional)
# ============================================
# Domain for OAuth callbacks
CLOUD_STORAGE_AUTH_DOMAIN=

# Dropbox Integration
# Setup: https://www.dropbox.com/developers/apps
DROPBOX_CLIENT_ID=
DROPBOX_CLIENT_SECRET=
DROPBOX_ENABLED=false

# OneDrive Integration
# Setup: https://portal.azure.com/
ONEDRIVE_CLIENT_ID=
ONEDRIVE_CLIENT_SECRET=
ONEDRIVE_TENANT_ID=common
ONEDRIVE_ENABLED=false

# ============================================
# Memcached Configuration (Alternative to Redis)
# ============================================
# Use if CACHE_ENGINE=memcached
MEMCACHED_SERVER=127.0.0.1
MEMCACHED_PORT=11211
MEMCACHED_PREFIX=cake_
MEMCACHED_LOG=true

# ============================================
# Advanced Cache Configuration
# ============================================
# General cache prefix for file-based cache
CACHE_PREFIX=cake_

# Redis persistent connections (set to true for production)
REDIS_PERSISTENT=false

# reCAPTCHA additional settings
RECAPTCHA_THEME=light
RECAPTCHA_SIZE=normal

# ============================================
# Service URLs (After Deployment)
# ============================================
# OrangeScrum App:       http://localhost:8080
# Redis (if enabled):    127.0.0.1:6379

# ============================================
# Deployment Notes
# ============================================
# 1. If ports are occupied, adjust the port numbers above
# 2. The deploy script will check for port availability
# 3. To deploy:
#    ./deploy.sh
# 4. To deploy with custom ports:
#    ./deploy.sh --app-port 8080 --pg-port 5433
# 5. To check prerequisites:
#    ./deploy.sh --check
