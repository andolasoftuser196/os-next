# Auto-generated Traefik dynamic configuration
# Domain: ossiba.online
# Generated: 2026-01-12 13:25:51

http:
  routers:
    # V4 Durango - Must come FIRST before wildcards
    durango:
      rule: "Host(`v4.ossiba.online`)"
      service: durango
      entryPoints:
        - websecure
      tls: {}
      priority: 100  # Higher priority than wildcards
    
    # Orangescrum V2 - Wildcard for all other subdomains
    orangescrum:
      rule: "HostRegexp(`{subdomain:[a-z0-9-]+}.ossiba.online`) && !Host(`v4.ossiba.online`, `selfhosted.ossiba.online`, `traefik.ossiba.online`, `storage.ossiba.online`, `console.ossiba.online`, `mail.ossiba.online`)"
      service: orangescrum
      entryPoints:
        - websecure
      tls: {}
      priority: 50  # Lower priority
    
    # MailHog
    mailhog:
      rule: "Host(`mail.ossiba.online`)"
      service: mailhog
      entryPoints:
        - websecure
      tls: {}
      priority: 100
    
    # Traefik Dashboard
    traefik-dashboard:
      rule: "Host(`traefik.ossiba.online`)"
      service: api@internal
      entryPoints:
        - websecure
      tls: {}
      priority: 100

  services:
    durango:
      loadBalancer:
        servers:
          - url: "http://durango-pg:80"
    
    orangescrum:
      loadBalancer:
        servers:
          - url: "http://orangescrum:80"
    
    mailhog:
      loadBalancer:
        servers:
          - url: "http://mailhog:8025"

tls:
  certificates:
    - certFile: /certs/ossiba.online.crt
      keyFile: /certs/ossiba.online.key
  stores:
    default:
      defaultCertificate:
        certFile: /certs/ossiba.online.crt
        keyFile: /certs/ossiba.online.key
