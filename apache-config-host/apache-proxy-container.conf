# Apache Reverse Proxy for Docker Container
# Routes ossiba.com -> Traefik (ossiba.local)
# This file is mounted into the Apache container
# Generated: 2026-02-13 12:04:33

ServerName localhost

# Enable required modules via LoadModule (handled in docker-compose command)

<VirtualHost *:80>
    ServerName app.ossiba.com
    ServerAlias *.ossiba.com
    
    # Redirect HTTP to HTTPS
    Redirect permanent / https://app.ossiba.com/
</VirtualHost>

# Main proxy - rewrites ossiba.com to ossiba.local for Traefik
<VirtualHost *:443>
    ServerName app.ossiba.com
    ServerAlias *.ossiba.com
    
    SSLEngine on
    SSLCertificateFile /certs/ossiba.com.crt
    SSLCertificateKeyFile /certs/ossiba.com.key
    
    # Proxy to Traefik container
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire off
    
    # Rewrite Host header from ossiba.com to ossiba.local
    RequestHeader set Host "%{HTTP_HOST}e"
    RequestHeader edit Host "ossiba\.com" "ossiba.local"
    
    ProxyPreserveHost Off
    ProxyPass / https://ossiba-local-traefik/
    ProxyPassReverse / https://ossiba-local-traefik/
    
    # Fix response headers
    Header edit Location "ossiba\.local" "ossiba.com"
    
    # WebSocket support
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "wss://ossiba-local-traefik/$1" [P,L]
    
    ErrorLog /dev/stderr
    CustomLog /dev/stdout combined
</VirtualHost>
