# Apache Reverse Proxy for Docker Container
# Routes andolatraefik.online -> Traefik (andolatraefik.online)
# This file is mounted into the Apache container
# Generated: 2026-02-12 19:43:42

ServerName localhost

# Enable required modules via LoadModule (handled in docker-compose command)

<VirtualHost *:80>
    ServerName app.andolatraefik.online
    ServerAlias *.andolatraefik.online
    
    # Redirect HTTP to HTTPS
    Redirect permanent / https://app.andolatraefik.online/
</VirtualHost>

# Main proxy - rewrites andolatraefik.online to andolatraefik.online for Traefik
<VirtualHost *:443>
    ServerName app.andolatraefik.online
    ServerAlias *.andolatraefik.online
    
    SSLEngine on
    SSLCertificateFile /certs/andolatraefik.online.crt
    SSLCertificateKeyFile /certs/andolatraefik.online.key
    
    # Proxy to Traefik container
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire off
    
    # Rewrite Host header from andolatraefik.online to andolatraefik.online
    RequestHeader set Host "%{HTTP_HOST}e"
    RequestHeader edit Host "andolatraefik\.online" "andolatraefik.online"
    
    ProxyPreserveHost Off
    ProxyPass / https://andolatraefik-online-traefik/
    ProxyPassReverse / https://andolatraefik-online-traefik/
    
    # Fix response headers
    Header edit Location "andolatraefik\.online" "andolatraefik.online"
    
    # WebSocket support
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "wss://andolatraefik-online-traefik/$1" [P,L]
    
    ErrorLog /dev/stderr
    CustomLog /dev/stdout combined
</VirtualHost>
