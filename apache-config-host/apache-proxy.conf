# Apache Reverse Proxy Configuration for OrangeScrum Docker
# Domain: andolatraefik.online
# Generated: 2026-02-12 19:43:42
# Traefik HTTPS Port: 10043 (unique per domain)
#
# Installation:
#   sudo cp apache-proxy.conf /etc/apache2/sites-available/orangescrum-andolatraefik-online.conf
#   sudo a2ensite orangescrum-andolatraefik-online
#   sudo systemctl reload apache2

<VirtualHost *:80>
    ServerName app.andolatraefik.online
    ServerAlias v4.andolatraefik.online selfhosted.andolatraefik.online mail.andolatraefik.online
    ServerAlias storage.andolatraefik.online console.andolatraefik.online traefik.andolatraefik.online
    ServerAlias *.andolatraefik.online
    
    # Redirect HTTP to HTTPS
    Redirect permanent / https://app.andolatraefik.online/
</VirtualHost>

# Main catch-all proxy for all subdomains
<VirtualHost *:443>
    ServerName app.andolatraefik.online
    ServerAlias *.andolatraefik.online
    
    SSLEngine on
    SSLCertificateFile /workspaces/os-next/certs/andolatraefik.online.crt
    SSLCertificateKeyFile /workspaces/os-next/certs/andolatraefik.online.key
    
    # Proxy all requests to Traefik on port 10043
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    SSLProxyCheckPeerExpire off
    
    ProxyPreserveHost On
    ProxyPass / https://127.0.0.1:10043/
    ProxyPassReverse / https://127.0.0.1:10043/
    
    # WebSocket support
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "wss://127.0.0.1:10043/$1" [P,L]
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/orangescrum-andolatraefik-online-error.log
    CustomLog ${APACHE_LOG_DIR}/orangescrum-andolatraefik-online-access.log combined
</VirtualHost>

# Individual VirtualHosts for better logging (optional)
<VirtualHost *:443>
    ServerName v4.andolatraefik.online
    
    SSLEngine on
    SSLCertificateFile /workspaces/os-next/certs/andolatraefik.online.crt
    SSLCertificateKeyFile /workspaces/os-next/certs/andolatraefik.online.key
    
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    
    ProxyPreserveHost On
    ProxyPass / https://127.0.0.1:10043/
    ProxyPassReverse / https://127.0.0.1:10043/
    
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "wss://127.0.0.1:10043/$1" [P,L]
    
    ErrorLog ${APACHE_LOG_DIR}/v4-andolatraefik-online-error.log
    CustomLog ${APACHE_LOG_DIR}/v4-andolatraefik-online-access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName selfhosted.andolatraefik.online
    
    SSLEngine on
    SSLCertificateFile /workspaces/os-next/certs/andolatraefik.online.crt
    SSLCertificateKeyFile /workspaces/os-next/certs/andolatraefik.online.key
    
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    
    ProxyPreserveHost On
    ProxyPass / https://127.0.0.1:10043/
    ProxyPassReverse / https://127.0.0.1:10043/
    
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "wss://127.0.0.1:10043/$1" [P,L]
    
    ErrorLog ${APACHE_LOG_DIR}/selfhosted-andolatraefik-online-error.log
    CustomLog ${APACHE_LOG_DIR}/selfhosted-andolatraefik-online-access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName mail.andolatraefik.online
    
    SSLEngine on
    SSLCertificateFile /workspaces/os-next/certs/andolatraefik.online.crt
    SSLCertificateKeyFile /workspaces/os-next/certs/andolatraefik.online.key
    
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    
    ProxyPreserveHost On
    ProxyPass / https://127.0.0.1:10043/
    ProxyPassReverse / https://127.0.0.1:10043/
    
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "wss://127.0.0.1:10043/$1" [P,L]
    
    ErrorLog ${APACHE_LOG_DIR}/mail-andolatraefik-online-error.log
    CustomLog ${APACHE_LOG_DIR}/mail-andolatraefik-online-access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName storage.andolatraefik.online
    
    SSLEngine on
    SSLCertificateFile /workspaces/os-next/certs/andolatraefik.online.crt
    SSLCertificateKeyFile /workspaces/os-next/certs/andolatraefik.online.key
    
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    
    ProxyPreserveHost On
    ProxyPass / https://127.0.0.1:10043/
    ProxyPassReverse / https://127.0.0.1:10043/
    
    ErrorLog ${APACHE_LOG_DIR}/storage-andolatraefik-online-error.log
    CustomLog ${APACHE_LOG_DIR}/storage-andolatraefik-online-access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName console.andolatraefik.online
    
    SSLEngine on
    SSLCertificateFile /workspaces/os-next/certs/andolatraefik.online.crt
    SSLCertificateKeyFile /workspaces/os-next/certs/andolatraefik.online.key
    
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    
    ProxyPreserveHost On
    ProxyPass / https://127.0.0.1:10043/
    ProxyPassReverse / https://127.0.0.1:10043/
    
    ErrorLog ${APACHE_LOG_DIR}/console-andolatraefik-online-error.log
    CustomLog ${APACHE_LOG_DIR}/console-andolatraefik-online-access.log combined
</VirtualHost>

<VirtualHost *:443>
    ServerName traefik.andolatraefik.online
    
    SSLEngine on
    SSLCertificateFile /workspaces/os-next/certs/andolatraefik.online.crt
    SSLCertificateKeyFile /workspaces/os-next/certs/andolatraefik.online.key
    
    SSLProxyEngine on
    SSLProxyVerify none
    SSLProxyCheckPeerCN off
    SSLProxyCheckPeerName off
    
    ProxyPreserveHost On
    ProxyPass / https://127.0.0.1:10043/
    ProxyPassReverse / https://127.0.0.1:10043/
    
    RewriteEngine on
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) "wss://127.0.0.1:10043/$1" [P,L]
    
    ErrorLog ${APACHE_LOG_DIR}/traefik-andolatraefik-online-error.log
    CustomLog ${APACHE_LOG_DIR}/traefik-andolatraefik-online-access.log combined
</VirtualHost>
