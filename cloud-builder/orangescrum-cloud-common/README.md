# OrangeScrum Cloud - Common Files

This directory contains **shared files** used by both Docker and Native deployments.

## Directory Structure

```
orangescrum-cloud-common/
├── orangescrum-app/                # FrankenPHP binary location (built)
│   └── osv4-prod                   # Static binary with embedded app (~340 MB)
│
├── config/                         # Configuration file templates
│   ├── cache_*.example.php        # Cache configuration examples
│   ├── storage.example.php        # S3 storage configuration
│   ├── smtp.example.php           # Email configuration
│   ├── queue.example.php          # Queue configuration
│   ├── apache/                    # Apache configs (if needed)
│   ├── cron/                      # Cron job configs
│   └── plugins/                   # Plugin configs
│
├── docs/                           # Shared documentation
│   ├── DEPLOYMENT.md
│   ├── ENVIRONMENT_CONFIGURATION.md
│   ├── PRODUCTION_DEPLOYMENT_DOCKER.md
│   ├── PRODUCTION_DEPLOYMENT_NATIVE.md
│   └── ...
│
├── helpers/                        # Shared helper scripts (if present)
│
├── .env.example                    # Base environment template
├── .env.full.example               # Complete configuration reference
├── CONFIGS.md                      # Configuration documentation
└── README.md                       # This file
```

## Purpose

These files are the **source of truth** for shared resources across deployments. They are copied by the build scripts:

- **orangescrum-cloud-docker/build.sh** → Assembles `dist-docker/` package
- **orangescrum-cloud-native/build.sh** → Assembles `dist-native/` package

## Note on Deployment

This folder contains source files only. Use the deployment packages for running the application:

- **dist-docker/** - Docker deployment package (auto-generated by build.py)
- **dist-native/** - Native deployment package (auto-generated by build.py)

## Building Deployments

```bash
# Build FrankenPHP binary and create deployment packages
# From the cloud-builder directory:
cd /home/ubuntu/workspace/os-next/cloud-builder
python3 build.py

# This will:
# 1. Build FrankenPHP binary → orangescrum-cloud-common/orangescrum-app/osv4-prod
# 2. Run Docker build script → dist-docker/
# 3. Run Native build script → dist-native/
```

## Making Changes

To update configuration or documentation:

1. **Edit files in this folder** (`orangescrum-cloud-common/`)
   ```bash
   cd orangescrum-cloud-common
   nano config/cache_redis.example.php
   nano docs/PRODUCTION_DEPLOYMENT_DOCKER.md
   ```

2. **Rebuild deployment packages:**
   ```bash
   # Rebuild Docker package
   cd ../orangescrum-cloud-docker
   ./build.sh
   
   # Rebuild Native package
   cd ../orangescrum-cloud-native
   ./build.sh
   
   # Or rebuild both using build.py
   cd ..
   python3 build.py --skip-archive --skip-base
   ```

## FrankenPHP Binary

The FrankenPHP static binary (`orangescrum-app/osv4-prod`) is built by `build.py` and contains:

- PHP 8.3 interpreter
- Caddy web server  
- Full OrangeScrum V4 application
- All PHP dependencies (vendor/)

**Size:** ~340 MB

Both Docker and Native deployments use the same binary copied from this location.

## Configuration Templates

Configuration files in `config/` are templates that get copied to deployment packages. They demonstrate various configuration options:

- **cache_*.example.php** - Different caching backends (Redis, Memcached, File, Auto)
- **storage.example.php** - S3-compatible storage (MinIO, AWS S3)
- **smtp.example.php** - Email via SMTP
- **sendgrid.example.php** - Email via SendGrid
- **queue.example.php** - Queue configuration
- **google_*.example.php** - Google integrations
- **github.example.php** - GitHub integration

See [CONFIGS.md](CONFIGS.md) for detailed configuration documentation.

## Documentation

Common documentation in `docs/` covers deployment and production setup for both Docker and Native deployments. This documentation is copied to both deployment packages so users have access regardless of deployment method.

